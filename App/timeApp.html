<!DOCTYPE html>
<html>

<head>
    <script src="https://unpkg.com/@asgardeo/auth-spa@latest/dist/asgardeo-spa.production.min.js"></script>

    <title>App1: Display Time as a Clock</title>
    <style>
        #clock {
            font-family: Arial, sans-serif;
            font-size: 48px;
            font-weight: bold;
            text-align: center;
        }
    </style>
</head>

<body>
    <script>
        // This client is a class and can be instantiated as follows.
        var auth = AsgardeoAuth.AsgardeoSPAClient.getInstance();

        // Once instantiated, the  client can be initialized by passing the relevant parameters such as the server origin, redirect URL, client ID, etc.
        auth.initialize({
            signInRedirectURL: "http://127.0.0.1:5500/App/timeApp.html",
            signOutRedirectURL: "http://127.0.0.1:5500/App/timeApp.html",
            clientID: "qN52B_k6IRoo4Z0G7iX5l1qINoQa",
            baseUrl: "https://api.asgardeo.io/t/org28f5u",
            scope: ["openid", "profile"]
        });
    </script>
    <div>

        <!-- Authenticated View --->
        <div id="authenticated-view" style="display: none;">
            <div>
                <div id="clock"></div>

                <script>
                    function updateClock() {
                        var now = new Date();
                        var hours = now.getHours();
                        var minutes = now.getMinutes();
                        var seconds = now.getSeconds();

                        hours = padZero(hours);
                        minutes = padZero(minutes);
                        seconds = padZero(seconds);

                        var time = hours + ":" + minutes + ":" + seconds;
                        document.getElementById("clock").textContent = time;

                        setTimeout(updateClock, 1000);
                    }

                    function padZero(num) {
                        return (num < 10 ? "0" : "") + num;
                    }

                    updateClock();
                </script>
            </div>
            <ul>
                <h1> Xin chào</h1>
                <li id="username"></li>
            </ul>
            <button onClick="auth.signOut()">Đăng xuất</button>
        </div>
        <!-- Un-Authenticated View --->
        <div id="unauthenticated-view" style="display: none;">
            <h1>Bạn chưa đăng nhập</h1>
            <button onClick="auth.signIn()">Đăng nhập</button>
        </div>
    </div>
    <script>
        (async () => {
            let user = undefined;

            // If there are auth search params i.e code, session_state, automatically trigger login.
            // Else, try to see if there's a session.
            if (AsgardeoAuth.SPAUtils.hasAuthSearchParamsInURL()) {
                user = await auth.signIn({ callOnlyOnRedirect: true });
            } else {
                user = await auth.trySignInSilently();
            }

            // Update the UI accordingly.
            if (user) {
                document.getElementById("authenticated-view").style.display = "block";
                document.getElementById("unauthenticated-view").style.display = "none";
                document.getElementById("username").innerHTML = user.orgName;
                console.log(user);
            } else {
                document.getElementById("authenticated-view").style.display = "none";
                document.getElementById("unauthenticated-view").style.display = "block";
            }
        })();
    </script>

</body>

</html>